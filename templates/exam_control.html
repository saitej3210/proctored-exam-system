<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Exam Control Panel</title>

<style>
*{box-sizing:border-box;font-family:"Segoe UI",Arial,sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#0f172a,#020617);
  color:#e5e7eb;
  padding:40px
}
.panel{max-width:1100px;margin:auto}

/* ACTIONS */
.actions{
  display:flex;
  gap:15px;
  margin-bottom:30px;
  flex-wrap:wrap
}
.btn{
  padding:12px 20px;
  border-radius:10px;
  border:none;
  font-size:14px;
  font-weight:600;
  cursor:pointer
}
.start{background:#2563eb;color:white}
.release{background:#22c55e;color:#052e16}
.results{background:#facc15;color:#422006}

/* CARD */
.card{
  background:rgba(255,255,255,.05);
  border-radius:16px;
  padding:25px;
  margin-bottom:30px
}

/* TABLE */
table{width:100%;border-collapse:collapse}
th,td{padding:14px 16px;text-align:left}
th{
  font-size:13px;
  text-transform:uppercase;
  color:#cbd5f5
}

/* STATUS */
.status{
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
  display:inline-block
}
.waiting{background:rgba(234,179,8,.2);color:#fde047}
.running{background:rgba(34,197,94,.2);color:#4ade80}
.paused{background:rgba(239,68,68,.2);color:#fca5a5}
.submitted{background:rgba(59,130,246,.2);color:#93c5fd}

/* BUTTONS */
.action-btn{
  padding:6px 12px;
  border-radius:8px;
  border:none;
  font-size:12px;
  cursor:pointer;
  margin-right:6px
}
.approve{background:#22c55e;color:#052e16}
.resume{background:#38bdf8;color:#082f49}
.remove{background:#ef4444;color:white}

/* VIOLATION BADGE */
.violation{
  background:rgba(239,68,68,.15);
  color:#fca5a5;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:700
}
</style>
</head>
<body>
  
<div class="panel">

<h2>ðŸ›¡ Exam Control Panel</h2>

<!-- ===== ACTIONS ===== -->
<div class="actions">
  <form method="POST" action="/admin/exam/{{ exam_id }}/start">
    <button class="btn start">ðŸš€ Start Exam</button>
  </form>

  <form method="POST" action="/admin/exam/{{ exam_id }}/release_results">
    <button class="btn release">ðŸŽ‰ Release Results</button>
  </form>

  <a href="/admin/exam/{{ exam_id }}/results">
    <button class="btn results">ðŸ“Š View Results</button>
  </a>

  <!-- âœ… NEW : ANALYTICS (SAFE ADD) -->
  <a href="/admin/exam/{{ exam_id }}/analytics">
    <button class="btn results">ðŸ“ˆ Exam Analytics</button>
  </a>
</div>
<!-- ===== STUDENTS ===== -->
<div class="card">
<h3>ðŸ‘¥ Students</h3>

<table>
<thead>
<tr>
  <th>Roll</th>
  <th>Name</th>
  <th>Exam Status</th>
  <th>Violations</th>
  <th>Action</th>
</tr>
</thead>

<tbody>
{% for s in students %}
<tr>

<td>{{ s.roll }}</td>
<td>{{ s.name }}</td>

<td>

  <!-- âœ… APPROVE (MID-EXAM SAFE) -->
  {% if s.student_status == 'waiting' %}
  <form method="POST"
        action="/admin/student/{{ s.student_id }}/approve"
        style="display:inline">
    <button class="action-btn approve">Approve</button>
  </form>
  {% endif %}

  <!-- RESUME -->
  {% if s.exam_status == "PAUSED" %}
  <form method="POST"
        action="/admin/exam/{{ exam_id }}/resume/{{ s.student_id }}"
        style="display:inline">
    <button class="action-btn resume">Resume</button>
  </form>
  {% endif %}

  <!-- REMOVE -->
  <form method="POST"
        action="/admin/remove-student/{{ exam_id }}/{{ s.roll }}"
        style="display:inline">
    <button class="action-btn remove">Remove</button>
  </form>

</td>

<td>
  <span class="violation">{{ s.violation_count }}</span>
</td>

<td>

  <!-- âœ… APPROVE (ONLY IF WAITING & EXAM NOT STARTED) -->
  {% if s.student_status == 'waiting' and not exam_started %}
  <form method="POST"
        action="/admin/student/{{ s.student_id }}/approve"
        style="display:inline">
    <button class="action-btn approve">Approve</button>
  </form>
  {% endif %}

  <!-- â–¶ RESUME -->
  {% if s.exam_status == "PAUSED" %}
  <form method="POST"
        action="/admin/exam/{{ exam_id }}/resume/{{ s.student_id }}"
        style="display:inline">
    <button class="action-btn resume">Resume</button>
  </form>
  {% endif %}
  {% if s.exam_status == "PAUSED" %}
  <form method="POST"
      action="/admin/exam/{{ exam_id }}/resume/{{ s.student_id }}"
      style="display:inline">
   <button class="action-btn resume">Resume</button>
  </form>
  {% endif %}
  <!-- âŒ REMOVE -->
  <form method="POST"
        action="/admin/remove-student/{{ exam_id }}/{{ s.roll }}"
        style="display:inline">
    <button class="action-btn remove">Remove</button>
  </form>

</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

</div>

</body>
</html>